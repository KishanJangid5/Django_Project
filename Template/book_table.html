{% extends "base.html" %}

{% block class %}class="sub_page"{% endblock class %}
{% block table_status %}active{% endblock table_status %}
{% block main %}

<!-- book section -->
<section class="book_section layout_padding">
  <div class="container">
    <div class="heading_container">
      <h2>
        Book A Table
      </h2>
    </div>
    <div class="row">
      <div class="col-md-6">
        <div class="form_container">
          <!-- Display messages here -->
          {% if messages %}
          <div class="alert alert-info">
            {% for message in messages %}
              <p>{{ message }}</p>
            {% endfor %}
          </div>
          {% endif %}

          <form id="booking-form" action="{% url 'Book_Table' %}" method='POST'>{% csrf_token %}
            <div>
              <input type="text" class="form-control" name="user_name" required placeholder="Your Name" />
            </div>
            <div>
              <input type="text" class="form-control" name="phone_number" required placeholder="Phone Number" />
            </div>
            <div>
              <input type="email" class="form-control" name="user_email" required placeholder="Your Email" />
            </div>
            <div>
              <select class="form-control nice-select wide" required name="total_person">
                <option value="" disabled selected>
                  How many persons?
                </option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
            </div>
            <div>
              <input type="date" required name="booking_data" class="form-control">
            </div>
            <div class="btn_box">
              <button type="submit">
                Book Now
              </button>
            </div>
          </form>
        </div>
      </div>
      

    </div>
  </div>
</section>
<!-- end book section -->



{% endblock main %}

<!-- Success Popup Modal -->
<div id="success-modal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Booking Successful</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p id="success-message">Your table has been booked successfully!</p>
        <p>Please check your email for confirmation details.</p>
        <p>Please select your food item as a pre order to save your time.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" onclick="window.location.href='{% url 'Menu' %}'">OK</button>
      </div>
    </div>
  </div>
</div>

<!-- Error Popup Modal -->
<div id="error-modal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Booking Failed</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p id="error-message">There was an error booking your table. Please try again.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
$(document).ready(function() {
  $('#booking-form').on('submit', function(e) {
    e.preventDefault();  // Prevent the default form submission

    var formData = new FormData(this);

    $.ajax({
      url: $(this).attr('action'),
      type: 'POST',
      data: formData,
      processData: false,
      contentType: false,
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      },
      success: function(response) {
        if (response.success) {
          $('#success-message').text(response.message);
          $('#success-modal').modal('show');
          $('#booking-form')[0].reset();  // Reset the form
        } else {
          $('#error-message').text(response.message);
          $('#error-modal').modal('show');
        }
      },
      error: function(xhr, status, error) {
        $('#error-message').text('An unexpected error occurred. Please try again.');
        $('#error-modal').modal('show');
      }
    });
  });
});
</script>
